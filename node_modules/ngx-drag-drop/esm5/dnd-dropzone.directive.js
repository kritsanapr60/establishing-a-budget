/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ContentChild, Directive, ElementRef, EventEmitter, HostListener, Input, NgZone, Output, Renderer2 } from "@angular/core";
import { getDirectChildElement, getDropData, shouldPositionPlaceholderBeforeElement } from "./dnd-utils";
import { getDndType, getDropEffect, isExternalDrag, setDropEffect } from "./dnd-state";
/**
 * @record
 */
import * as ɵngcc0 from '@angular/core';
export function DndDropEvent() { }
if (false) {
    /** @type {?} */
    DndDropEvent.prototype.event;
    /** @type {?} */
    DndDropEvent.prototype.dropEffect;
    /** @type {?} */
    DndDropEvent.prototype.isExternal;
    /** @type {?|undefined} */
    DndDropEvent.prototype.data;
    /** @type {?|undefined} */
    DndDropEvent.prototype.index;
    /** @type {?|undefined} */
    DndDropEvent.prototype.type;
}
var DndPlaceholderRefDirective = /** @class */ (function () {
    function DndPlaceholderRefDirective(elementRef) {
        this.elementRef = elementRef;
    }
    /** @nocollapse */
    DndPlaceholderRefDirective.ctorParameters = function () { return [
        { type: ElementRef }
    ]; };
DndPlaceholderRefDirective.ɵfac = function DndPlaceholderRefDirective_Factory(t) { return new (t || DndPlaceholderRefDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef)); };
DndPlaceholderRefDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: DndPlaceholderRefDirective, selectors: [["", "dndPlaceholderRef", ""]] });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(DndPlaceholderRefDirective, [{
        type: Directive,
        args: [{
                selector: "[dndPlaceholderRef]"
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }]; }, null); })();
    return DndPlaceholderRefDirective;
}());
export { DndPlaceholderRefDirective };
if (false) {
    /** @type {?} */
    DndPlaceholderRefDirective.prototype.elementRef;
}
var DndDropzoneDirective = /** @class */ (function () {
    function DndDropzoneDirective(ngZone, elementRef, renderer) {
        var _this = this;
        this.ngZone = ngZone;
        this.elementRef = elementRef;
        this.renderer = renderer;
        this.dndAllowExternal = false;
        this.dndHorizontal = false;
        this.dndDragoverClass = "dndDragover";
        this.dndDropzoneDisabledClass = "dndDropzoneDisabled";
        this.dndDragover = new EventEmitter();
        this.dndDrop = new EventEmitter();
        this.placeholder = null;
        this.disabled = false;
        this.dragEnterEventHandler = (/**
         * @param {?} event
         * @return {?}
         */
        function (event) { return _this.onDragEnter(event); });
        this.dragOverEventHandler = (/**
         * @param {?} event
         * @return {?}
         */
        function (event) { return _this.onDragOver(event); });
        this.dragLeaveEventHandler = (/**
         * @param {?} event
         * @return {?}
         */
        function (event) { return _this.onDragLeave(event); });
    }
    Object.defineProperty(DndDropzoneDirective.prototype, "dndDisableIf", {
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this.disabled = !!value;
            if (this.disabled) {
                this.renderer.addClass(this.elementRef.nativeElement, this.dndDropzoneDisabledClass);
            }
            else {
                this.renderer.removeClass(this.elementRef.nativeElement, this.dndDropzoneDisabledClass);
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DndDropzoneDirective.prototype, "dndDisableDropIf", {
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this.dndDisableIf = value;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    DndDropzoneDirective.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.placeholder = this.tryGetPlaceholder();
        this.removePlaceholderFromDOM();
        this.ngZone.runOutsideAngular((/**
         * @return {?}
         */
        function () {
            _this.elementRef.nativeElement.addEventListener("dragenter", _this.dragEnterEventHandler);
            _this.elementRef.nativeElement.addEventListener("dragover", _this.dragOverEventHandler);
            _this.elementRef.nativeElement.addEventListener("dragleave", _this.dragLeaveEventHandler);
        }));
    };
    /**
     * @return {?}
     */
    DndDropzoneDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.elementRef.nativeElement.removeEventListener("dragenter", this.dragEnterEventHandler);
        this.elementRef.nativeElement.removeEventListener("dragover", this.dragOverEventHandler);
        this.elementRef.nativeElement.removeEventListener("dragleave", this.dragLeaveEventHandler);
    };
    /**
     * @param {?} event
     * @return {?}
     */
    DndDropzoneDirective.prototype.onDragEnter = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        // check if another dropzone is activated
        if (event._dndDropzoneActive === true) {
            this.cleanupDragoverState();
            return;
        }
        // set as active if the target element is inside this dropzone
        if (typeof event._dndDropzoneActive === "undefined") {
            /** @type {?} */
            var newTarget = document.elementFromPoint(event.clientX, event.clientY);
            if (this.elementRef.nativeElement.contains(newTarget)) {
                event._dndDropzoneActive = true;
            }
        }
        // check if this drag event is allowed to drop on this dropzone
        /** @type {?} */
        var type = getDndType(event);
        if (this.isDropAllowed(type) === false) {
            return;
        }
        // allow the dragenter
        event.preventDefault();
    };
    /**
     * @param {?} event
     * @return {?}
     */
    DndDropzoneDirective.prototype.onDragOver = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        // With nested dropzones, we want to ignore this event if a child dropzone
        // has already handled a dragover.  Historically, event.stopPropagation() was
        // used to prevent this bubbling, but that prevents any dragovers outside the
        // ngx-drag-drop component, and stops other use cases such as scrolling on drag.
        // Instead, we can check if the event was already prevented by a child and bail early.
        if (event.defaultPrevented) {
            return;
        }
        // check if this drag event is allowed to drop on this dropzone
        /** @type {?} */
        var type = getDndType(event);
        if (this.isDropAllowed(type) === false) {
            return;
        }
        this.checkAndUpdatePlaceholderPosition(event);
        /** @type {?} */
        var dropEffect = getDropEffect(event, this.dndEffectAllowed);
        if (dropEffect === "none") {
            this.cleanupDragoverState();
            return;
        }
        // allow the dragover
        event.preventDefault();
        // set the drop effect
        setDropEffect(event, dropEffect);
        this.dndDragover.emit(event);
        this.renderer.addClass(this.elementRef.nativeElement, this.dndDragoverClass);
    };
    /**
     * @param {?} event
     * @return {?}
     */
    DndDropzoneDirective.prototype.onDrop = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        try {
            // check if this drag event is allowed to drop on this dropzone
            /** @type {?} */
            var type = getDndType(event);
            if (this.isDropAllowed(type) === false) {
                return;
            }
            /** @type {?} */
            var data = getDropData(event, isExternalDrag());
            if (this.isDropAllowed(data.type) === false) {
                return;
            }
            // signal custom drop handling
            event.preventDefault();
            /** @type {?} */
            var dropEffect = getDropEffect(event);
            setDropEffect(event, dropEffect);
            if (dropEffect === "none") {
                return;
            }
            /** @type {?} */
            var dropIndex = this.getPlaceholderIndex();
            // if for whatever reason the placeholder is not present in the DOM but it should be there
            // we don't allow/emit the drop event since it breaks the contract
            // seems to only happen if drag and drop is executed faster than the DOM updates
            if (dropIndex === -1) {
                return;
            }
            this.dndDrop.emit({
                event: event,
                dropEffect: dropEffect,
                isExternal: isExternalDrag(),
                data: data.data,
                index: dropIndex,
                type: type,
            });
            event.stopPropagation();
        }
        finally {
            this.cleanupDragoverState();
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    DndDropzoneDirective.prototype.onDragLeave = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        // check if still inside this dropzone and not yet handled by another dropzone
        if (typeof event._dndDropzoneActive === "undefined") {
            /** @type {?} */
            var newTarget = document.elementFromPoint(event.clientX, event.clientY);
            if (this.elementRef.nativeElement.contains(newTarget)) {
                event._dndDropzoneActive = true;
                return;
            }
        }
        this.cleanupDragoverState();
        // cleanup drop effect when leaving dropzone
        setDropEffect(event, "none");
    };
    /**
     * @private
     * @param {?=} type
     * @return {?}
     */
    DndDropzoneDirective.prototype.isDropAllowed = /**
     * @private
     * @param {?=} type
     * @return {?}
     */
    function (type) {
        // dropzone is disabled -> deny it
        if (this.disabled === true) {
            return false;
        }
        // if drag did not start from our directive
        // and external drag sources are not allowed -> deny it
        if (isExternalDrag() === true
            && this.dndAllowExternal === false) {
            return false;
        }
        // no filtering by types -> allow it
        if (!this.dndDropzone) {
            return true;
        }
        // no type set -> allow it
        if (!type) {
            return true;
        }
        if (Array.isArray(this.dndDropzone) === false) {
            throw new Error("dndDropzone: bound value to [dndDropzone] must be an array!");
        }
        // if dropzone contains type -> allow it
        return this.dndDropzone.indexOf(type) !== -1;
    };
    /**
     * @private
     * @return {?}
     */
    DndDropzoneDirective.prototype.tryGetPlaceholder = /**
     * @private
     * @return {?}
     */
    function () {
        if (typeof this.dndPlaceholderRef !== "undefined") {
            return (/** @type {?} */ (this.dndPlaceholderRef.elementRef.nativeElement));
        }
        // TODO nasty workaround needed because if ng-container / template is used @ContentChild() or DI will fail because
        // of wrong context see angular bug https://github.com/angular/angular/issues/13517
        return this.elementRef.nativeElement.querySelector("[dndPlaceholderRef]");
    };
    /**
     * @private
     * @return {?}
     */
    DndDropzoneDirective.prototype.removePlaceholderFromDOM = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.placeholder !== null
            && this.placeholder.parentNode !== null) {
            this.placeholder.parentNode.removeChild(this.placeholder);
        }
    };
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    DndDropzoneDirective.prototype.checkAndUpdatePlaceholderPosition = /**
     * @private
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (this.placeholder === null) {
            return;
        }
        // make sure the placeholder is in the DOM
        if (this.placeholder.parentNode !== this.elementRef.nativeElement) {
            this.renderer.appendChild(this.elementRef.nativeElement, this.placeholder);
        }
        // update the position if the event originates from a child element of the dropzone
        /** @type {?} */
        var directChild = getDirectChildElement(this.elementRef.nativeElement, (/** @type {?} */ (event.target)));
        // early exit if no direct child or direct child is placeholder
        if (directChild === null
            || directChild === this.placeholder) {
            return;
        }
        /** @type {?} */
        var positionPlaceholderBeforeDirectChild = shouldPositionPlaceholderBeforeElement(event, directChild, this.dndHorizontal);
        if (positionPlaceholderBeforeDirectChild) {
            // do insert before only if necessary
            if (directChild.previousSibling !== this.placeholder) {
                this.renderer.insertBefore(this.elementRef.nativeElement, this.placeholder, directChild);
            }
        }
        else {
            // do insert after only if necessary
            if (directChild.nextSibling !== this.placeholder) {
                this.renderer.insertBefore(this.elementRef.nativeElement, this.placeholder, directChild.nextSibling);
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    DndDropzoneDirective.prototype.getPlaceholderIndex = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.placeholder === null) {
            return undefined;
        }
        /** @type {?} */
        var element = (/** @type {?} */ (this.elementRef.nativeElement));
        return Array.prototype.indexOf.call(element.children, this.placeholder);
    };
    /**
     * @private
     * @return {?}
     */
    DndDropzoneDirective.prototype.cleanupDragoverState = /**
     * @private
     * @return {?}
     */
    function () {
        this.renderer.removeClass(this.elementRef.nativeElement, this.dndDragoverClass);
        this.removePlaceholderFromDOM();
    };
    /** @nocollapse */
    DndDropzoneDirective.ctorParameters = function () { return [
        { type: NgZone },
        { type: ElementRef },
        { type: Renderer2 }
    ]; };
    DndDropzoneDirective.propDecorators = {
        dndDropzone: [{ type: Input }],
        dndEffectAllowed: [{ type: Input }],
        dndAllowExternal: [{ type: Input }],
        dndHorizontal: [{ type: Input }],
        dndDragoverClass: [{ type: Input }],
        dndDropzoneDisabledClass: [{ type: Input }],
        dndDragover: [{ type: Output }],
        dndDrop: [{ type: Output }],
        dndPlaceholderRef: [{ type: ContentChild, args: [DndPlaceholderRefDirective,] }],
        dndDisableIf: [{ type: Input }],
        dndDisableDropIf: [{ type: Input }],
        onDrop: [{ type: HostListener, args: ["drop", ["$event"],] }]
    };
DndDropzoneDirective.ɵfac = function DndDropzoneDirective_Factory(t) { return new (t || DndDropzoneDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2)); };
DndDropzoneDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: DndDropzoneDirective, selectors: [["", "dndDropzone", ""]], contentQueries: function DndDropzoneDirective_ContentQueries(rf, ctx, dirIndex) { if (rf & 1) {
        ɵngcc0.ɵɵcontentQuery(dirIndex, DndPlaceholderRefDirective, true);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.dndPlaceholderRef = _t.first);
    } }, hostBindings: function DndDropzoneDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("drop", function DndDropzoneDirective_drop_HostBindingHandler($event) { return ctx.onDrop($event); });
    } }, inputs: { dndAllowExternal: "dndAllowExternal", dndHorizontal: "dndHorizontal", dndDragoverClass: "dndDragoverClass", dndDropzoneDisabledClass: "dndDropzoneDisabledClass", dndDisableIf: "dndDisableIf", dndDisableDropIf: "dndDisableDropIf", dndDropzone: "dndDropzone", dndEffectAllowed: "dndEffectAllowed" }, outputs: { dndDragover: "dndDragover", dndDrop: "dndDrop" } });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(DndDropzoneDirective, [{
        type: Directive,
        args: [{
                selector: "[dndDropzone]"
            }]
    }], function () { return [{ type: ɵngcc0.NgZone }, { type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }]; }, { dndAllowExternal: [{
            type: Input
        }], dndHorizontal: [{
            type: Input
        }], dndDragoverClass: [{
            type: Input
        }], dndDropzoneDisabledClass: [{
            type: Input
        }], dndDragover: [{
            type: Output
        }], dndDrop: [{
            type: Output
        }], dndDisableIf: [{
            type: Input
        }], dndDisableDropIf: [{
            type: Input
        }], onDrop: [{
            type: HostListener,
            args: ["drop", ["$event"]]
        }], dndDropzone: [{
            type: Input
        }], dndEffectAllowed: [{
            type: Input
        }], dndPlaceholderRef: [{
            type: ContentChild,
            args: [DndPlaceholderRefDirective]
        }] }); })();
    return DndDropzoneDirective;
}());
export { DndDropzoneDirective };
if (false) {
    /** @type {?} */
    DndDropzoneDirective.prototype.dndDropzone;
    /** @type {?} */
    DndDropzoneDirective.prototype.dndEffectAllowed;
    /** @type {?} */
    DndDropzoneDirective.prototype.dndAllowExternal;
    /** @type {?} */
    DndDropzoneDirective.prototype.dndHorizontal;
    /** @type {?} */
    DndDropzoneDirective.prototype.dndDragoverClass;
    /** @type {?} */
    DndDropzoneDirective.prototype.dndDropzoneDisabledClass;
    /** @type {?} */
    DndDropzoneDirective.prototype.dndDragover;
    /** @type {?} */
    DndDropzoneDirective.prototype.dndDrop;
    /**
     * @type {?}
     * @private
     */
    DndDropzoneDirective.prototype.dndPlaceholderRef;
    /**
     * @type {?}
     * @private
     */
    DndDropzoneDirective.prototype.placeholder;
    /**
     * @type {?}
     * @private
     */
    DndDropzoneDirective.prototype.disabled;
    /**
     * @type {?}
     * @private
     */
    DndDropzoneDirective.prototype.dragEnterEventHandler;
    /**
     * @type {?}
     * @private
     */
    DndDropzoneDirective.prototype.dragOverEventHandler;
    /**
     * @type {?}
     * @private
     */
    DndDropzoneDirective.prototype.dragLeaveEventHandler;
    /**
     * @type {?}
     * @private
     */
    DndDropzoneDirective.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    DndDropzoneDirective.prototype.elementRef;
    /**
     * @type {?}
     * @private
     */
    DndDropzoneDirective.prototype.renderer;
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG5kLWRyb3B6b25lLmRpcmVjdGl2ZS5qcyIsInNvdXJjZXMiOlsibmd4LWRyYWctZHJvcC9kbmQtZHJvcHpvbmUuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBRUwsWUFBWSxFQUNaLFNBQVMsRUFDVCxVQUFVLEVBQ1YsWUFBWSxFQUNaLFlBQVksRUFDWixLQUFLLEVBQ0wsTUFBTSxFQUVOLE1BQU0sRUFDTixTQUFTLEVBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUdMLHFCQUFxQixFQUNyQixXQUFXLEVBQ1gsc0NBQXNDLEVBQ3ZDLE1BQU0sYUFBYSxDQUFDO0FBQ3JCLE9BQU8sRUFBRSxVQUFVLEVBQUUsYUFBYSxFQUFFLGNBQWMsRUFBRSxhQUFhLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDdkY7QUFBSTtBQUFXOztBQUVmLGtDQU9DO0FBQ0Q7QUFDWTtBQUNPLElBVGpCLDZCQUFnQjtBQUNsQjtBQUFxQixJQUFuQixrQ0FBc0I7QUFDeEI7QUFBcUIsSUFBbkIsa0NBQW1CO0FBQ3JCO0FBRUMsSUFGQyw0QkFBVTtBQUNaO0FBRUMsSUFGQyw2QkFBYztBQUNoQjtBQUlDLElBSkMsNEJBQVU7QUFDWjtBQUVBO0FBR1UsSUFFUixvQ0FBNkIsVUFBcUI7QUFBSSxRQUF6QixlQUFVLEdBQVYsVUFBVSxDQUFXO0FBQUMsSUFDbkQsQ0FBQyxBQUhLO0FBQUM7dUNBSFIsU0FBUyxTQUFFLHpEQUdvQjtRQUY5QixRQUFRLEVBQUUsbEJBS1QsZ0JBbENELFVBQVU7QUFDWDtBQTRCZ0Msa0JBQ2hDOzs7Ozs7OzJFQTdCUztBQUFDLElBa0NYLGlDQUFDO0FBRUQsQ0FGQyxBQVBELElBT0M7QUFDRCxTQUxhLDBCQUEwQjtBQUV2QztBQUFhO0FBQXFCLElBQW5CLGdEQUFxQztBQUFDO0FBSXJEO0FBR1UsSUF5RFIsOEJBQXFCLE1BQWEsRUFDYixVQUFxQixFQUNyQixRQUFrQjtBQUFJLFFBRjNDLGlCQUdDO0FBQ0gs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O0FBQzFDO0FBRVMsSUFEUCx3REFDaUQ7QUFDbkQ7QUFFUSxJQUROLDJDQUM2RTtBQUMvRTtBQUVRLElBRE4sdUNBQytFO0FBQ2pGO0FBQ087QUFBaUI7QUFBZ0I7QUFDdEMsSUFEQSxpREFDK0Q7QUFDakU7QUFDTztBQUFpQjtBQUFnQjtBQUV0QyxJQUZBLDJDQUEwQztBQUM1QztBQUNPO0FBQWlCO0FBRXJCO0FBQVEsSUFGVCx3Q0FBaUM7QUFDbkM7QUFDTztBQUFpQjtBQUFnQjtBQUFRLElBQTlDLHFEQUFzSDtBQUN4SDtBQUFRO0FBQWlCO0FBQWdCO0FBQVEsSUFBL0Msb0RBQW9IO0FBQ3RIO0FBQVE7QUFBaUI7QUFBZ0I7QUFBUSxJQUEvQyxxREFBc0g7QUFDeEg7QUFDTztBQUNNO0FBQWdCO0FBQVEsSUFtQnRCLHNDQUFxQjtBQUFDO0FBQzlCO0FBQWlCO0FBQWdCO0FBQ3RDLElBRGEsMENBQTZCO0FBQUM7QUFDdEM7QUFBaUI7QUFBZ0I7QUFDdEMsSUFEYSx3Q0FBMEI7QUFBQztBQUFFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ29udGVudENoaWxkLFxuICBEaXJlY3RpdmUsXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgSG9zdExpc3RlbmVyLFxuICBJbnB1dCxcbiAgTmdab25lLFxuICBPbkRlc3Ryb3ksXG4gIE91dHB1dCxcbiAgUmVuZGVyZXIyXG59IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQge1xuICBEbmRFdmVudCxcbiAgRHJhZ0Ryb3BEYXRhLFxuICBnZXREaXJlY3RDaGlsZEVsZW1lbnQsXG4gIGdldERyb3BEYXRhLFxuICBzaG91bGRQb3NpdGlvblBsYWNlaG9sZGVyQmVmb3JlRWxlbWVudFxufSBmcm9tIFwiLi9kbmQtdXRpbHNcIjtcbmltcG9ydCB7IGdldERuZFR5cGUsIGdldERyb3BFZmZlY3QsIGlzRXh0ZXJuYWxEcmFnLCBzZXREcm9wRWZmZWN0IH0gZnJvbSBcIi4vZG5kLXN0YXRlXCI7XG5pbXBvcnQgeyBEcm9wRWZmZWN0LCBFZmZlY3RBbGxvd2VkIH0gZnJvbSBcIi4vZG5kLXR5cGVzXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRG5kRHJvcEV2ZW50IHtcbiAgZXZlbnQ6RHJhZ0V2ZW50O1xuICBkcm9wRWZmZWN0OkRyb3BFZmZlY3Q7XG4gIGlzRXh0ZXJuYWw6Ym9vbGVhbjtcbiAgZGF0YT86YW55O1xuICBpbmRleD86bnVtYmVyO1xuICB0eXBlPzphbnk7XG59XG5cbkBEaXJlY3RpdmUoIHtcbiAgc2VsZWN0b3I6IFwiW2RuZFBsYWNlaG9sZGVyUmVmXVwiXG59IClcbmV4cG9ydCBjbGFzcyBEbmRQbGFjZWhvbGRlclJlZkRpcmVjdGl2ZSB7XG5cbiAgY29uc3RydWN0b3IoIHB1YmxpYyByZWFkb25seSBlbGVtZW50UmVmOkVsZW1lbnRSZWYgKSB7XG4gIH1cbn1cblxuQERpcmVjdGl2ZSgge1xuICBzZWxlY3RvcjogXCJbZG5kRHJvcHpvbmVdXCJcbn0gKVxuZXhwb3J0IGNsYXNzIERuZERyb3B6b25lRGlyZWN0aXZlIGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcblxuICBASW5wdXQoKVxuICBkbmREcm9wem9uZT86c3RyaW5nW107XG5cbiAgQElucHV0KClcbiAgZG5kRWZmZWN0QWxsb3dlZDpFZmZlY3RBbGxvd2VkO1xuXG4gIEBJbnB1dCgpXG4gIGRuZEFsbG93RXh0ZXJuYWw6Ym9vbGVhbiA9IGZhbHNlO1xuXG4gIEBJbnB1dCgpXG4gIGRuZEhvcml6b250YWw6Ym9vbGVhbiA9IGZhbHNlO1xuXG4gIEBJbnB1dCgpXG4gIGRuZERyYWdvdmVyQ2xhc3M6c3RyaW5nID0gXCJkbmREcmFnb3ZlclwiO1xuXG4gIEBJbnB1dCgpXG4gIGRuZERyb3B6b25lRGlzYWJsZWRDbGFzcyA9IFwiZG5kRHJvcHpvbmVEaXNhYmxlZFwiO1xuXG4gIEBPdXRwdXQoKVxuICByZWFkb25seSBkbmREcmFnb3ZlcjpFdmVudEVtaXR0ZXI8RHJhZ0V2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8RHJhZ0V2ZW50PigpO1xuXG4gIEBPdXRwdXQoKVxuICByZWFkb25seSBkbmREcm9wOkV2ZW50RW1pdHRlcjxEbmREcm9wRXZlbnQ+ID0gbmV3IEV2ZW50RW1pdHRlcjxEbmREcm9wRXZlbnQ+KCk7XG5cbiAgQENvbnRlbnRDaGlsZCggRG5kUGxhY2Vob2xkZXJSZWZEaXJlY3RpdmUgKVxuICBwcml2YXRlIHJlYWRvbmx5IGRuZFBsYWNlaG9sZGVyUmVmPzpEbmRQbGFjZWhvbGRlclJlZkRpcmVjdGl2ZTtcblxuICBwcml2YXRlIHBsYWNlaG9sZGVyOkVsZW1lbnQgfCBudWxsID0gbnVsbDtcblxuICBwcml2YXRlIGRpc2FibGVkOmJvb2xlYW4gPSBmYWxzZTtcblxuICBwcml2YXRlIHJlYWRvbmx5IGRyYWdFbnRlckV2ZW50SGFuZGxlcjooIGV2ZW50OkRyYWdFdmVudCApID0+IHZvaWQgPSAoIGV2ZW50OkRyYWdFdmVudCApID0+IHRoaXMub25EcmFnRW50ZXIoIGV2ZW50ICk7XG4gIHByaXZhdGUgcmVhZG9ubHkgZHJhZ092ZXJFdmVudEhhbmRsZXI6KCBldmVudDpEcmFnRXZlbnQgKSA9PiB2b2lkID0gKCBldmVudDpEcmFnRXZlbnQgKSA9PiB0aGlzLm9uRHJhZ092ZXIoIGV2ZW50ICk7XG4gIHByaXZhdGUgcmVhZG9ubHkgZHJhZ0xlYXZlRXZlbnRIYW5kbGVyOiggZXZlbnQ6RHJhZ0V2ZW50ICkgPT4gdm9pZCA9ICggZXZlbnQ6RHJhZ0V2ZW50ICkgPT4gdGhpcy5vbkRyYWdMZWF2ZSggZXZlbnQgKTtcblxuICBASW5wdXQoKVxuICBzZXQgZG5kRGlzYWJsZUlmKCB2YWx1ZTpib29sZWFuICkge1xuXG4gICAgdGhpcy5kaXNhYmxlZCA9ICEhdmFsdWU7XG5cbiAgICBpZiggdGhpcy5kaXNhYmxlZCApIHtcblxuICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyggdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsIHRoaXMuZG5kRHJvcHpvbmVEaXNhYmxlZENsYXNzICk7XG4gICAgfVxuICAgIGVsc2Uge1xuXG4gICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNsYXNzKCB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgdGhpcy5kbmREcm9wem9uZURpc2FibGVkQ2xhc3MgKTtcbiAgICB9XG4gIH1cblxuICBASW5wdXQoKVxuICBzZXQgZG5kRGlzYWJsZURyb3BJZiggdmFsdWU6Ym9vbGVhbiApIHtcbiAgICB0aGlzLmRuZERpc2FibGVJZiA9IHZhbHVlO1xuICB9XG5cbiAgY29uc3RydWN0b3IoIHByaXZhdGUgbmdab25lOk5nWm9uZSxcbiAgICAgICAgICAgICAgIHByaXZhdGUgZWxlbWVudFJlZjpFbGVtZW50UmVmLFxuICAgICAgICAgICAgICAgcHJpdmF0ZSByZW5kZXJlcjpSZW5kZXJlcjIgKSB7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKTp2b2lkIHtcblxuICAgIHRoaXMucGxhY2Vob2xkZXIgPSB0aGlzLnRyeUdldFBsYWNlaG9sZGVyKCk7XG5cbiAgICB0aGlzLnJlbW92ZVBsYWNlaG9sZGVyRnJvbURPTSgpO1xuXG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoICgpID0+IHtcbiAgICAgIHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoIFwiZHJhZ2VudGVyXCIsIHRoaXMuZHJhZ0VudGVyRXZlbnRIYW5kbGVyICk7XG4gICAgICB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCBcImRyYWdvdmVyXCIsIHRoaXMuZHJhZ092ZXJFdmVudEhhbmRsZXIgKTtcbiAgICAgIHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoIFwiZHJhZ2xlYXZlXCIsIHRoaXMuZHJhZ0xlYXZlRXZlbnRIYW5kbGVyICk7XG4gICAgfSApO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTp2b2lkIHtcbiAgICB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCBcImRyYWdlbnRlclwiLCB0aGlzLmRyYWdFbnRlckV2ZW50SGFuZGxlciApO1xuICAgIHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoIFwiZHJhZ292ZXJcIiwgdGhpcy5kcmFnT3ZlckV2ZW50SGFuZGxlciApO1xuICAgIHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoIFwiZHJhZ2xlYXZlXCIsIHRoaXMuZHJhZ0xlYXZlRXZlbnRIYW5kbGVyICk7XG4gIH1cblxuICBvbkRyYWdFbnRlciggZXZlbnQ6RG5kRXZlbnQgKSB7XG5cbiAgICAvLyBjaGVjayBpZiBhbm90aGVyIGRyb3B6b25lIGlzIGFjdGl2YXRlZFxuICAgIGlmKCBldmVudC5fZG5kRHJvcHpvbmVBY3RpdmUgPT09IHRydWUgKSB7XG5cbiAgICAgIHRoaXMuY2xlYW51cERyYWdvdmVyU3RhdGUoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBzZXQgYXMgYWN0aXZlIGlmIHRoZSB0YXJnZXQgZWxlbWVudCBpcyBpbnNpZGUgdGhpcyBkcm9wem9uZVxuICAgIGlmKCB0eXBlb2YgZXZlbnQuX2RuZERyb3B6b25lQWN0aXZlID09PSBcInVuZGVmaW5lZFwiICkge1xuXG4gICAgICBjb25zdCBuZXdUYXJnZXQgPSBkb2N1bWVudC5lbGVtZW50RnJvbVBvaW50KCBldmVudC5jbGllbnRYLCBldmVudC5jbGllbnRZICk7XG5cbiAgICAgIGlmKCB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5jb250YWlucyggbmV3VGFyZ2V0ICkgKSB7XG5cbiAgICAgICAgZXZlbnQuX2RuZERyb3B6b25lQWN0aXZlID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBjaGVjayBpZiB0aGlzIGRyYWcgZXZlbnQgaXMgYWxsb3dlZCB0byBkcm9wIG9uIHRoaXMgZHJvcHpvbmVcbiAgICBjb25zdCB0eXBlID0gZ2V0RG5kVHlwZSggZXZlbnQgKTtcbiAgICBpZiggdGhpcy5pc0Ryb3BBbGxvd2VkKCB0eXBlICkgPT09IGZhbHNlICkge1xuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gYWxsb3cgdGhlIGRyYWdlbnRlclxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIH1cblxuICBvbkRyYWdPdmVyKCBldmVudDpEcmFnRXZlbnQgKSB7XG4gICAgLy8gV2l0aCBuZXN0ZWQgZHJvcHpvbmVzLCB3ZSB3YW50IHRvIGlnbm9yZSB0aGlzIGV2ZW50IGlmIGEgY2hpbGQgZHJvcHpvbmVcbiAgICAvLyBoYXMgYWxyZWFkeSBoYW5kbGVkIGEgZHJhZ292ZXIuICBIaXN0b3JpY2FsbHksIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpIHdhc1xuICAgIC8vIHVzZWQgdG8gcHJldmVudCB0aGlzIGJ1YmJsaW5nLCBidXQgdGhhdCBwcmV2ZW50cyBhbnkgZHJhZ292ZXJzIG91dHNpZGUgdGhlXG4gICAgLy8gbmd4LWRyYWctZHJvcCBjb21wb25lbnQsIGFuZCBzdG9wcyBvdGhlciB1c2UgY2FzZXMgc3VjaCBhcyBzY3JvbGxpbmcgb24gZHJhZy5cbiAgICAvLyBJbnN0ZWFkLCB3ZSBjYW4gY2hlY2sgaWYgdGhlIGV2ZW50IHdhcyBhbHJlYWR5IHByZXZlbnRlZCBieSBhIGNoaWxkIGFuZCBiYWlsIGVhcmx5LlxuICAgIGlmKCBldmVudC5kZWZhdWx0UHJldmVudGVkICkge1xuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gY2hlY2sgaWYgdGhpcyBkcmFnIGV2ZW50IGlzIGFsbG93ZWQgdG8gZHJvcCBvbiB0aGlzIGRyb3B6b25lXG4gICAgY29uc3QgdHlwZSA9IGdldERuZFR5cGUoIGV2ZW50ICk7XG4gICAgaWYoIHRoaXMuaXNEcm9wQWxsb3dlZCggdHlwZSApID09PSBmYWxzZSApIHtcblxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuY2hlY2tBbmRVcGRhdGVQbGFjZWhvbGRlclBvc2l0aW9uKCBldmVudCApO1xuXG4gICAgY29uc3QgZHJvcEVmZmVjdCA9IGdldERyb3BFZmZlY3QoIGV2ZW50LCB0aGlzLmRuZEVmZmVjdEFsbG93ZWQgKTtcblxuICAgIGlmKCBkcm9wRWZmZWN0ID09PSBcIm5vbmVcIiApIHtcblxuICAgICAgdGhpcy5jbGVhbnVwRHJhZ292ZXJTdGF0ZSgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIGFsbG93IHRoZSBkcmFnb3ZlclxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAvLyBzZXQgdGhlIGRyb3AgZWZmZWN0XG4gICAgc2V0RHJvcEVmZmVjdCggZXZlbnQsIGRyb3BFZmZlY3QgKTtcblxuICAgIHRoaXMuZG5kRHJhZ292ZXIuZW1pdCggZXZlbnQgKTtcblxuICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3MoIHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCB0aGlzLmRuZERyYWdvdmVyQ2xhc3MgKTtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoIFwiZHJvcFwiLCBbIFwiJGV2ZW50XCIgXSApXG4gIG9uRHJvcCggZXZlbnQ6RHJhZ0V2ZW50ICkge1xuXG4gICAgdHJ5IHtcblxuICAgICAgLy8gY2hlY2sgaWYgdGhpcyBkcmFnIGV2ZW50IGlzIGFsbG93ZWQgdG8gZHJvcCBvbiB0aGlzIGRyb3B6b25lXG4gICAgICBjb25zdCB0eXBlID0gZ2V0RG5kVHlwZSggZXZlbnQgKTtcbiAgICAgIGlmKCB0aGlzLmlzRHJvcEFsbG93ZWQoIHR5cGUgKSA9PT0gZmFsc2UgKSB7XG5cbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBkYXRhOkRyYWdEcm9wRGF0YSA9IGdldERyb3BEYXRhKCBldmVudCwgaXNFeHRlcm5hbERyYWcoKSApO1xuXG4gICAgICBpZiggdGhpcy5pc0Ryb3BBbGxvd2VkKCBkYXRhLnR5cGUgKSA9PT0gZmFsc2UgKSB7XG5cbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBzaWduYWwgY3VzdG9tIGRyb3AgaGFuZGxpbmdcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgIGNvbnN0IGRyb3BFZmZlY3QgPSBnZXREcm9wRWZmZWN0KCBldmVudCApO1xuXG4gICAgICBzZXREcm9wRWZmZWN0KCBldmVudCwgZHJvcEVmZmVjdCApO1xuXG4gICAgICBpZiggZHJvcEVmZmVjdCA9PT0gXCJub25lXCIgKSB7XG5cbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBkcm9wSW5kZXggPSB0aGlzLmdldFBsYWNlaG9sZGVySW5kZXgoKTtcblxuICAgICAgLy8gaWYgZm9yIHdoYXRldmVyIHJlYXNvbiB0aGUgcGxhY2Vob2xkZXIgaXMgbm90IHByZXNlbnQgaW4gdGhlIERPTSBidXQgaXQgc2hvdWxkIGJlIHRoZXJlXG4gICAgICAvLyB3ZSBkb24ndCBhbGxvdy9lbWl0IHRoZSBkcm9wIGV2ZW50IHNpbmNlIGl0IGJyZWFrcyB0aGUgY29udHJhY3RcbiAgICAgIC8vIHNlZW1zIHRvIG9ubHkgaGFwcGVuIGlmIGRyYWcgYW5kIGRyb3AgaXMgZXhlY3V0ZWQgZmFzdGVyIHRoYW4gdGhlIERPTSB1cGRhdGVzXG4gICAgICBpZiggZHJvcEluZGV4ID09PSAtMSApIHtcblxuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHRoaXMuZG5kRHJvcC5lbWl0KCB7XG4gICAgICAgIGV2ZW50OiBldmVudCxcbiAgICAgICAgZHJvcEVmZmVjdDogZHJvcEVmZmVjdCxcbiAgICAgICAgaXNFeHRlcm5hbDogaXNFeHRlcm5hbERyYWcoKSxcbiAgICAgICAgZGF0YTogZGF0YS5kYXRhLFxuICAgICAgICBpbmRleDogZHJvcEluZGV4LFxuICAgICAgICB0eXBlOiB0eXBlLFxuICAgICAgfSApO1xuXG4gICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgIH1cbiAgICBmaW5hbGx5IHtcblxuICAgICAgdGhpcy5jbGVhbnVwRHJhZ292ZXJTdGF0ZSgpO1xuICAgIH1cbiAgfVxuXG4gIG9uRHJhZ0xlYXZlKCBldmVudDpEbmRFdmVudCApIHtcblxuICAgIC8vIGNoZWNrIGlmIHN0aWxsIGluc2lkZSB0aGlzIGRyb3B6b25lIGFuZCBub3QgeWV0IGhhbmRsZWQgYnkgYW5vdGhlciBkcm9wem9uZVxuICAgIGlmKCB0eXBlb2YgZXZlbnQuX2RuZERyb3B6b25lQWN0aXZlID09PSBcInVuZGVmaW5lZFwiICkge1xuXG4gICAgICBjb25zdCBuZXdUYXJnZXQgPSBkb2N1bWVudC5lbGVtZW50RnJvbVBvaW50KCBldmVudC5jbGllbnRYLCBldmVudC5jbGllbnRZICk7XG5cbiAgICAgIGlmKCB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5jb250YWlucyggbmV3VGFyZ2V0ICkgKSB7XG5cbiAgICAgICAgZXZlbnQuX2RuZERyb3B6b25lQWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuY2xlYW51cERyYWdvdmVyU3RhdGUoKTtcblxuICAgIC8vIGNsZWFudXAgZHJvcCBlZmZlY3Qgd2hlbiBsZWF2aW5nIGRyb3B6b25lXG4gICAgc2V0RHJvcEVmZmVjdCggZXZlbnQsIFwibm9uZVwiICk7XG4gIH1cblxuICBwcml2YXRlIGlzRHJvcEFsbG93ZWQoIHR5cGU/OnN0cmluZyApOmJvb2xlYW4ge1xuXG4gICAgLy8gZHJvcHpvbmUgaXMgZGlzYWJsZWQgLT4gZGVueSBpdFxuICAgIGlmKCB0aGlzLmRpc2FibGVkID09PSB0cnVlICkge1xuXG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gaWYgZHJhZyBkaWQgbm90IHN0YXJ0IGZyb20gb3VyIGRpcmVjdGl2ZVxuICAgIC8vIGFuZCBleHRlcm5hbCBkcmFnIHNvdXJjZXMgYXJlIG5vdCBhbGxvd2VkIC0+IGRlbnkgaXRcbiAgICBpZiggaXNFeHRlcm5hbERyYWcoKSA9PT0gdHJ1ZVxuICAgICAgJiYgdGhpcy5kbmRBbGxvd0V4dGVybmFsID09PSBmYWxzZSApIHtcblxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIG5vIGZpbHRlcmluZyBieSB0eXBlcyAtPiBhbGxvdyBpdFxuICAgIGlmKCAhdGhpcy5kbmREcm9wem9uZSApIHtcblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLy8gbm8gdHlwZSBzZXQgLT4gYWxsb3cgaXRcbiAgICBpZiggIXR5cGUgKSB7XG5cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGlmKCBBcnJheS5pc0FycmF5KCB0aGlzLmRuZERyb3B6b25lICkgPT09IGZhbHNlICkge1xuXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoIFwiZG5kRHJvcHpvbmU6IGJvdW5kIHZhbHVlIHRvIFtkbmREcm9wem9uZV0gbXVzdCBiZSBhbiBhcnJheSFcIiApO1xuICAgIH1cblxuICAgIC8vIGlmIGRyb3B6b25lIGNvbnRhaW5zIHR5cGUgLT4gYWxsb3cgaXRcbiAgICByZXR1cm4gdGhpcy5kbmREcm9wem9uZS5pbmRleE9mKCB0eXBlICkgIT09IC0xO1xuICB9XG5cbiAgcHJpdmF0ZSB0cnlHZXRQbGFjZWhvbGRlcigpOkVsZW1lbnQgfCBudWxsIHtcblxuICAgIGlmKCB0eXBlb2YgdGhpcy5kbmRQbGFjZWhvbGRlclJlZiAhPT0gXCJ1bmRlZmluZWRcIiApIHtcblxuICAgICAgcmV0dXJuIHRoaXMuZG5kUGxhY2Vob2xkZXJSZWYuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50IGFzIEVsZW1lbnQ7XG4gICAgfVxuXG4gICAgLy8gVE9ETyBuYXN0eSB3b3JrYXJvdW5kIG5lZWRlZCBiZWNhdXNlIGlmIG5nLWNvbnRhaW5lciAvIHRlbXBsYXRlIGlzIHVzZWQgQENvbnRlbnRDaGlsZCgpIG9yIERJIHdpbGwgZmFpbCBiZWNhdXNlXG4gICAgLy8gb2Ygd3JvbmcgY29udGV4dCBzZWUgYW5ndWxhciBidWcgaHR0cHM6Ly9naXRodWIuY29tL2FuZ3VsYXIvYW5ndWxhci9pc3N1ZXMvMTM1MTdcbiAgICByZXR1cm4gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvciggXCJbZG5kUGxhY2Vob2xkZXJSZWZdXCIgKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVtb3ZlUGxhY2Vob2xkZXJGcm9tRE9NKCkge1xuXG4gICAgaWYoIHRoaXMucGxhY2Vob2xkZXIgIT09IG51bGxcbiAgICAgICYmIHRoaXMucGxhY2Vob2xkZXIucGFyZW50Tm9kZSAhPT0gbnVsbCApIHtcbiAgICAgIHRoaXMucGxhY2Vob2xkZXIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggdGhpcy5wbGFjZWhvbGRlciApO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tBbmRVcGRhdGVQbGFjZWhvbGRlclBvc2l0aW9uKCBldmVudDpEcmFnRXZlbnQgKTp2b2lkIHtcblxuICAgIGlmKCB0aGlzLnBsYWNlaG9sZGVyID09PSBudWxsICkge1xuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gbWFrZSBzdXJlIHRoZSBwbGFjZWhvbGRlciBpcyBpbiB0aGUgRE9NXG4gICAgaWYoIHRoaXMucGxhY2Vob2xkZXIucGFyZW50Tm9kZSAhPT0gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQgKSB7XG5cbiAgICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQoIHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCB0aGlzLnBsYWNlaG9sZGVyICk7XG4gICAgfVxuXG4gICAgLy8gdXBkYXRlIHRoZSBwb3NpdGlvbiBpZiB0aGUgZXZlbnQgb3JpZ2luYXRlcyBmcm9tIGEgY2hpbGQgZWxlbWVudCBvZiB0aGUgZHJvcHpvbmVcbiAgICBjb25zdCBkaXJlY3RDaGlsZCA9IGdldERpcmVjdENoaWxkRWxlbWVudCggdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsIGV2ZW50LnRhcmdldCBhcyBFbGVtZW50ICk7XG5cbiAgICAvLyBlYXJseSBleGl0IGlmIG5vIGRpcmVjdCBjaGlsZCBvciBkaXJlY3QgY2hpbGQgaXMgcGxhY2Vob2xkZXJcbiAgICBpZiggZGlyZWN0Q2hpbGQgPT09IG51bGxcbiAgICAgIHx8IGRpcmVjdENoaWxkID09PSB0aGlzLnBsYWNlaG9sZGVyICkge1xuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgcG9zaXRpb25QbGFjZWhvbGRlckJlZm9yZURpcmVjdENoaWxkID0gc2hvdWxkUG9zaXRpb25QbGFjZWhvbGRlckJlZm9yZUVsZW1lbnQoIGV2ZW50LCBkaXJlY3RDaGlsZCwgdGhpcy5kbmRIb3Jpem9udGFsICk7XG5cbiAgICBpZiggcG9zaXRpb25QbGFjZWhvbGRlckJlZm9yZURpcmVjdENoaWxkICkge1xuXG4gICAgICAvLyBkbyBpbnNlcnQgYmVmb3JlIG9ubHkgaWYgbmVjZXNzYXJ5XG4gICAgICBpZiggZGlyZWN0Q2hpbGQucHJldmlvdXNTaWJsaW5nICE9PSB0aGlzLnBsYWNlaG9sZGVyICkge1xuXG4gICAgICAgIHRoaXMucmVuZGVyZXIuaW5zZXJ0QmVmb3JlKCB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgdGhpcy5wbGFjZWhvbGRlciwgZGlyZWN0Q2hpbGQgKTtcbiAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG5cbiAgICAgIC8vIGRvIGluc2VydCBhZnRlciBvbmx5IGlmIG5lY2Vzc2FyeVxuICAgICAgaWYoIGRpcmVjdENoaWxkLm5leHRTaWJsaW5nICE9PSB0aGlzLnBsYWNlaG9sZGVyICkge1xuXG4gICAgICAgIHRoaXMucmVuZGVyZXIuaW5zZXJ0QmVmb3JlKCB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgdGhpcy5wbGFjZWhvbGRlciwgZGlyZWN0Q2hpbGQubmV4dFNpYmxpbmcgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldFBsYWNlaG9sZGVySW5kZXgoKTpudW1iZXIgfCB1bmRlZmluZWQge1xuXG4gICAgaWYoIHRoaXMucGxhY2Vob2xkZXIgPT09IG51bGwgKSB7XG5cbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgY29uc3QgZWxlbWVudCA9IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50IGFzIEhUTUxFbGVtZW50O1xuXG4gICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5pbmRleE9mLmNhbGwoIGVsZW1lbnQuY2hpbGRyZW4sIHRoaXMucGxhY2Vob2xkZXIgKTtcbiAgfVxuXG4gIHByaXZhdGUgY2xlYW51cERyYWdvdmVyU3RhdGUoKSB7XG5cbiAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNsYXNzKCB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgdGhpcy5kbmREcmFnb3ZlckNsYXNzICk7XG5cbiAgICB0aGlzLnJlbW92ZVBsYWNlaG9sZGVyRnJvbURPTSgpO1xuICB9XG59XG4iXX0=